<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="968px" preserveAspectRatio="none" style="width:1861px;height:968px;" version="1.1" viewBox="0 0 1861 968" width="1861px" zoomAndPan="magnify"><defs><filter height="300%" id="f1p0y3ryiycrh" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="68" x2="68" y1="102.1875" y2="870.375"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="455.5" x2="455.5" y1="102.1875" y2="870.375"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1020" x2="1020" y1="102.1875" y2="870.375"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1575.5" x2="1575.5" y1="102.1875" y2="870.375"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="121" x="5" y="96.9141">DFSP User</text><ellipse cx="68.5" cy="15" fill="#F8F8F8" filter="url(#f1p0y3ryiycrh)" rx="8" ry="8" style="stroke:#383838;stroke-width:2.0;"/><path d="M68.5,23 L68.5,50 M55.5,31 L81.5,31 M68.5,50 L55.5,65 M68.5,50 L81.5,65 " fill="none" filter="url(#f1p0y3ryiycrh)" style="stroke:#383838;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="121" x="5" y="894.2891">DFSP User</text><ellipse cx="68.5" cy="909.5625" fill="#F8F8F8" filter="url(#f1p0y3ryiycrh)" rx="8" ry="8" style="stroke:#383838;stroke-width:2.0;"/><path d="M68.5,917.5625 L68.5,944.5625 M55.5,925.5625 L81.5,925.5625 M68.5,944.5625 L55.5,959.5625 M68.5,944.5625 L81.5,959.5625 " fill="none" filter="url(#f1p0y3ryiycrh)" style="stroke:#383838;stroke-width:2.0;"/><rect fill="#F8F8F8" filter="url(#f1p0y3ryiycrh)" height="74.375" style="stroke:#383838;stroke-width:1.5;" width="250" x="328.5" y="22.8125"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="196" x="352" y="54.7266">Payment Manager</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="229" x="342.5" y="84.9141">accessed via browser</text><rect fill="#F8F8F8" filter="url(#f1p0y3ryiycrh)" height="74.375" style="stroke:#383838;stroke-width:1.5;" width="250" x="328.5" y="869.375"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="196" x="352" y="901.2891">Payment Manager</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="229" x="342.5" y="931.4766">accessed via browser</text><rect fill="#F8F8F8" filter="url(#f1p0y3ryiycrh)" height="44.1875" style="stroke:#383838;stroke-width:1.5;" width="177" x="930" y="53"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="163" x="937" y="84.9141">Experience API</text><rect fill="#F8F8F8" filter="url(#f1p0y3ryiycrh)" height="44.1875" style="stroke:#383838;stroke-width:1.5;" width="177" x="930" y="869.375"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="163" x="937" y="901.2891">Experience API</text><rect fill="#F8F8F8" filter="url(#f1p0y3ryiycrh)" height="44.1875" style="stroke:#383838;stroke-width:1.5;" width="116" x="1515.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="102" x="1522.5" y="84.9141">KeyCloak</text><rect fill="#F8F8F8" filter="url(#f1p0y3ryiycrh)" height="44.1875" style="stroke:#383838;stroke-width:1.5;" width="116" x="1515.5" y="869.375"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="102" x="1522.5" y="901.2891">KeyCloak</text><polygon fill="#383838" points="443.5,144.375,453.5,148.375,443.5,152.375,447.5,148.375" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="68.5" x2="449.5" y1="148.375" y2="148.375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="13" x="75.5" y="141.1016">1</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="279" x="92.5" y="141.1016">Access Payment Manager</text><polygon fill="#383838" points="1008.5,188.5625,1018.5,192.5625,1008.5,196.5625,1012.5,192.5625" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="455.5" x2="1014.5" y1="192.5625" y2="192.5625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="13" x="462.5" y="185.2891">2</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="303" x="479.5" y="185.2891">Make authentication request</text><line style="stroke:#383838;stroke-width:1.0;" x1="1020.5" x2="1062.5" y1="297.125" y2="297.125"/><line style="stroke:#383838;stroke-width:1.0;" x1="1062.5" x2="1062.5" y1="297.125" y2="310.125"/><line style="stroke:#383838;stroke-width:1.0;" x1="1021.5" x2="1062.5" y1="310.125" y2="310.125"/><polygon fill="#383838" points="1031.5,306.125,1021.5,310.125,1031.5,314.125,1027.5,310.125" style="stroke:#383838;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="13" x="1027.5" y="259.6641">3</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="381" x="1044.5" y="229.4766">Check if user already has a session</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="279" x="1051.5" y="259.6641">with authentication tokens</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="296" x="1051.5" y="289.8516">&gt;&gt; User is not logged in yet</text><polygon fill="#383838" points="466.5,350.3125,456.5,354.3125,466.5,358.3125,462.5,354.3125" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="460.5" x2="1019.5" y1="354.3125" y2="354.3125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="13" x="472.5" y="347.0391">4</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="524" x="489.5" y="347.0391">Redirect user's request to KeyCloak sign-in page</text><polygon fill="#383838" points="1563.5,394.5,1573.5,398.5,1563.5,402.5,1567.5,398.5" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="68.5" x2="1569.5" y1="398.5" y2="398.5"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="13" x="75.5" y="391.2266">5</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="588" x="92.5" y="391.2266">Sign in to Payment Manager on KeyCloak sign-in page</text><line style="stroke:#383838;stroke-width:1.0;" x1="1575.5" x2="1617.5" y1="442.6875" y2="442.6875"/><line style="stroke:#383838;stroke-width:1.0;" x1="1617.5" x2="1617.5" y1="442.6875" y2="455.6875"/><line style="stroke:#383838;stroke-width:1.0;" x1="1576.5" x2="1617.5" y1="455.6875" y2="455.6875"/><polygon fill="#383838" points="1586.5,451.6875,1576.5,455.6875,1586.5,459.6875,1582.5,455.6875" style="stroke:#383838;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="13" x="1582.5" y="435.4141">6</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="255" x="1599.5" y="435.4141">Verify user's credentials</text><polygon fill="#383838" points="1031.5,526.0625,1021.5,530.0625,1031.5,534.0625,1027.5,530.0625" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="1025.5" x2="1574.5" y1="530.0625" y2="530.0625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="13" x="1037.5" y="507.6953">7</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="378" x="1054.5" y="492.6016">Redirect browser to Experience API</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="262" x="1061.5" y="522.7891">pass Authorization Code</text><polygon fill="#383838" points="1563.5,570.25,1573.5,574.25,1563.5,578.25,1567.5,574.25" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="1020.5" x2="1569.5" y1="574.25" y2="574.25"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="13" x="1027.5" y="566.9766">8</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="487" x="1044.5" y="566.9766">Present Authorization Code to request tokens</text><polygon fill="#383838" points="1031.5,614.4375,1021.5,618.4375,1031.5,622.4375,1027.5,618.4375" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="1025.5" x2="1574.5" y1="618.4375" y2="618.4375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="13" x="1037.5" y="611.1641">9</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="387" x="1054.5" y="611.1641">Provide ID Token and Access Token</text><polygon fill="#383838" points="1563.5,658.625,1573.5,662.625,1563.5,666.625,1567.5,662.625" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="1020.5" x2="1569.5" y1="662.625" y2="662.625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="1027.5" y="655.3516">10</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="455" x="1057.5" y="655.3516">Request user information (using ID Token)</text><polygon fill="#383838" points="1031.5,702.8125,1021.5,706.8125,1031.5,710.8125,1027.5,706.8125" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="1025.5" x2="1574.5" y1="706.8125" y2="706.8125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="1037.5" y="699.5391">11</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="253" x="1067.5" y="699.5391">Return user information</text><polygon fill="#383838" points="443.5,747,453.5,751,443.5,755,447.5,751" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="68.5" x2="449.5" y1="751" y2="751"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="75.5" y="743.7266">12</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="333" x="105.5" y="743.7266">Interact with Payment Manager</text><polygon fill="#383838" points="1008.5,791.1875,1018.5,795.1875,1008.5,799.1875,1012.5,795.1875" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="455.5" x2="1014.5" y1="795.1875" y2="795.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="462.5" y="787.9141">13</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="0" x="499.5" y="787.9141"/><line style="stroke:#383838;stroke-width:1.0;" x1="1020.5" x2="1062.5" y1="839.375" y2="839.375"/><line style="stroke:#383838;stroke-width:1.0;" x1="1062.5" x2="1062.5" y1="839.375" y2="852.375"/><line style="stroke:#383838;stroke-width:1.0;" x1="1021.5" x2="1062.5" y1="852.375" y2="852.375"/><polygon fill="#383838" points="1031.5,848.375,1021.5,852.375,1031.5,856.375,1027.5,852.375" style="stroke:#383838;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="1027.5" y="832.1016">14</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="511" x="1057.5" y="832.1016">Look up user's roles and allow/deny user action</text><!--MD5=[44f560fa8a0be59056c5936c9ce3209e]
@startuml

autonumber
skinparam activityFontSize 4
skinparam activityDiamondFontSize 30
skinparam activityArrowFontSize 24
skinparam defaultFontSize 24
skinparam noteFontSize 24
skinparam monochrome true

actor "DFSP User" as user
participant "Payment Manager \n accessed via browser" as browser
participant "Experience API" as api
participant "KeyCloak" as keycloak

user -> browser: Access Payment Manager
browser -> api: Make authentication request
api -> api: Check if user already has a session \n with authentication tokens \n >> User is not logged in yet
api -> browser: Redirect user's request to KeyCloak sign-in page
user -> keycloak: Sign in to Payment Manager on KeyCloak sign-in page
keycloak -> keycloak: Verify user's credentials
keycloak -> api: Redirect browser to Experience API \n pass Authorization Code
api -> keycloak: Present Authorization Code to request tokens
keycloak -> api: Provide ID Token and Access Token
api -> keycloak: Request user information (using ID Token)
keycloak -> api: Return user information
user -> browser: Interact with Payment Manager
browser -> api: 
api -> api: Look up user's roles and allow/deny user action

@enduml

PlantUML version 1.2021.00(Sun Jan 10 11:25:05 CET 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: Cp1250
Language: en
Country: US
--></g></svg>