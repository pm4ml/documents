<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2166px" preserveAspectRatio="none" style="width:1247px;height:2166px;" version="1.1" viewBox="0 0 1247 2166" width="1247px" zoomAndPan="magnify"><defs><filter height="300%" id="f71guqz1k6q8d" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f71guqz1k6q8d)" height="405.0625" style="stroke:#000000;stroke-width:2.0;" width="1036" x="10" y="173.5625"/><rect fill="#FFFFFF" height="194.9375" style="stroke:none;stroke-width:1.0;" width="1036" x="10" y="383.6875"/><rect fill="#FFFFFF" filter="url(#f71guqz1k6q8d)" height="373.875" style="stroke:#000000;stroke-width:2.0;" width="1036" x="10" y="711.1875"/><rect fill="#FFFFFF" height="207.9375" style="stroke:none;stroke-width:1.0;" width="1036" x="10" y="877.125"/><rect fill="#FFFFFF" filter="url(#f71guqz1k6q8d)" height="312.5" style="stroke:#000000;stroke-width:2.0;" width="1171.5" x="10" y="1274.8125"/><rect fill="#FFFFFF" height="146.5625" style="stroke:none;stroke-width:1.0;" width="1171.5" x="10" y="1440.75"/><rect fill="#FFFFFF" filter="url(#f71guqz1k6q8d)" height="491.4375" style="stroke:#000000;stroke-width:2.0;" width="1220.5" x="10" y="1601.3125"/><rect fill="#FFFFFF" height="238.125" style="stroke:none;stroke-width:1.0;" width="1220.5" x="10" y="1854.625"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="140" x2="140" y1="54.1875" y2="2109.75"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="585.5" x2="585.5" y1="54.1875" y2="2109.75"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="939" x2="939" y1="54.1875" y2="2109.75"/><rect fill="#F8F8F8" filter="url(#f71guqz1k6q8d)" height="44.1875" style="stroke:#383838;stroke-width:1.5;" width="237" x="20" y="5"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="223" x="27" y="36.9141">DFSP Core Backend</text><rect fill="#F8F8F8" filter="url(#f71guqz1k6q8d)" height="44.1875" style="stroke:#383838;stroke-width:1.5;" width="237" x="20" y="2108.75"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="223" x="27" y="2140.6641">DFSP Core Backend</text><rect fill="#F8F8F8" filter="url(#f71guqz1k6q8d)" height="44.1875" style="stroke:#383838;stroke-width:1.5;" width="210" x="478.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="196" x="485.5" y="36.9141">Payment Manager</text><rect fill="#F8F8F8" filter="url(#f71guqz1k6q8d)" height="44.1875" style="stroke:#383838;stroke-width:1.5;" width="210" x="478.5" y="2108.75"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="196" x="485.5" y="2140.6641">Payment Manager</text><rect fill="#F8F8F8" filter="url(#f71guqz1k6q8d)" height="44.1875" style="stroke:#383838;stroke-width:1.5;" width="189" x="843" y="5"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="175" x="850" y="36.9141">Mojaloop Switch</text><rect fill="#F8F8F8" filter="url(#f71guqz1k6q8d)" height="44.1875" style="stroke:#383838;stroke-width:1.5;" width="189" x="843" y="2108.75"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="175" x="850" y="2140.6641">Mojaloop Switch</text><rect fill="#EEEEEE" filter="url(#f71guqz1k6q8d)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1240.5" x="0" y="92.2813"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1240.5" y1="92.2813" y2="92.2813"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1240.5" y1="95.2813" y2="95.2813"/><rect fill="#EEEEEE" filter="url(#f71guqz1k6q8d)" height="38.1875" style="stroke:#000000;stroke-width:2.0;" width="161" x="539.75" y="74.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="140" x="545.75" y="103.1016">send money</text><polygon fill="#383838" points="573.5,154.5625,583.5,158.5625,573.5,162.5625,577.5,158.5625" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="140.5" x2="579.5" y1="158.5625" y2="158.5625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="13" x="147.5" y="151.2891">1</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="277" x="164.5" y="151.2891">POST /sendmoney (sync)</text><path d="M10,173.5625 L83,173.5625 L83,195.5625 L73,205.5625 L10,205.5625 L10,173.5625 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="405.0625" style="stroke:#000000;stroke-width:2.0;" width="1036" x="10" y="173.5625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="28" x="25" y="199.4766">alt</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="204" x="98" y="200.4766">[Payee not found]</text><polygon fill="#383838" points="927.5,253.125,937.5,257.125,927.5,261.125,931.5,257.125" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="585.5" x2="933.5" y1="257.125" y2="257.125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="13" x="592.5" y="249.8516">2</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="246" x="609.5" y="249.8516">GET /parties/{type}/{id}</text><polygon fill="#383838" points="596.5,297.3125,586.5,301.3125,596.5,305.3125,592.5,301.3125" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="590.5" x2="938.5" y1="301.3125" y2="301.3125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="13" x="602.5" y="294.0391">3</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="301" x="619.5" y="294.0391">PUT /parties/{type}/{id}/error</text><polygon fill="#383838" points="151.5,371.6875,141.5,375.6875,151.5,379.6875,147.5,375.6875" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="145.5" x2="584.5" y1="375.6875" y2="375.6875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="13" x="157.5" y="353.3203">4</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="130" x="174.5" y="338.2266">Return error</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="247" x="181.5" y="368.4141">HTTP 200 result (sync)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1046" y1="384.6875" y2="384.6875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="355" x="15" y="409.6016">[Payee DFSP and Payee found]</text><polygon fill="#383838" points="927.5,448.0625,937.5,452.0625,927.5,456.0625,931.5,452.0625" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="585.5" x2="933.5" y1="452.0625" y2="452.0625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="13" x="592.5" y="444.7891">5</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="246" x="609.5" y="444.7891">GET /parties/{type}/{id}</text><polygon fill="#383838" points="596.5,492.25,586.5,496.25,596.5,500.25,592.5,496.25" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="590.5" x2="938.5" y1="496.25" y2="496.25"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="13" x="602.5" y="488.9766">6</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="244" x="619.5" y="488.9766">PUT /parties/{type}/{id}</text><polygon fill="#383838" points="151.5,566.625,141.5,570.625,151.5,574.625,147.5,570.625" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="145.5" x2="584.5" y1="570.625" y2="570.625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="13" x="157.5" y="548.2578">7</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="180" x="174.5" y="533.1641">Return party info</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="247" x="181.5" y="563.3516">HTTP 200 result (sync)</text><polygon fill="#383838" points="573.5,648,583.5,652,573.5,656,577.5,652" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="140.5" x2="579.5" y1="652" y2="652"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="13" x="147.5" y="629.6328">8</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="384" x="164.5" y="614.5391">PUT /sendmoney/{transferId} (sync)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="217" x="171.5" y="644.7266">("acceptParty": true)</text><polygon fill="#383838" points="927.5,692.1875,937.5,696.1875,927.5,700.1875,931.5,696.1875" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="585.5" x2="933.5" y1="696.1875" y2="696.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="13" x="592.5" y="688.9141">9</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="152" x="609.5" y="688.9141">POST /quotes</text><path d="M10,711.1875 L83,711.1875 L83,733.1875 L73,743.1875 L10,743.1875 L10,711.1875 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="373.875" style="stroke:#000000;stroke-width:2.0;" width="1036" x="10" y="711.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="28" x="25" y="737.1016">alt</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="233" x="98" y="738.1016">[Quote request fails]</text><polygon fill="#383838" points="596.5,790.75,586.5,794.75,596.5,798.75,592.5,794.75" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="590.5" x2="938.5" y1="794.75" y2="794.75"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="602.5" y="787.4766">10</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="233" x="632.5" y="787.4766">PUT /quotes/{id}/error</text><polygon fill="#383838" points="151.5,865.125,141.5,869.125,151.5,873.125,147.5,869.125" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="145.5" x2="584.5" y1="869.125" y2="869.125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="157.5" y="846.7578">11</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="130" x="187.5" y="831.6641">Return error</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="247" x="194.5" y="861.8516">HTTP 200 result (sync)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1046" y1="878.125" y2="878.125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="335" x="15" y="903.0391">[Quote request is successful]</text><polygon fill="#383838" points="596.5,941.5,586.5,945.5,596.5,949.5,592.5,945.5" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="590.5" x2="938.5" y1="945.5" y2="945.5"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="602.5" y="938.2266">12</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="176" x="632.5" y="938.2266">PUT /quotes/{id}</text><line style="stroke:#383838;stroke-width:1.0;" x1="585.5" x2="627.5" y1="989.6875" y2="989.6875"/><line style="stroke:#383838;stroke-width:1.0;" x1="627.5" x2="627.5" y1="989.6875" y2="1002.6875"/><line style="stroke:#383838;stroke-width:1.0;" x1="586.5" x2="627.5" y1="1002.6875" y2="1002.6875"/><polygon fill="#383838" points="596.5,998.6875,586.5,1002.6875,596.5,1006.6875,592.5,1002.6875" style="stroke:#383838;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="592.5" y="982.4141">13</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="191" x="622.5" y="982.4141">check quote rules</text><polygon fill="#383838" points="151.5,1073.0625,141.5,1077.0625,151.5,1081.0625,147.5,1077.0625" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="145.5" x2="584.5" y1="1077.0625" y2="1077.0625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="157.5" y="1054.6953">14</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="141" x="187.5" y="1039.6016">Return quote</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="247" x="194.5" y="1069.7891">HTTP 200 result (sync)</text><polygon fill="#383838" points="573.5,1154.4375,583.5,1158.4375,573.5,1162.4375,577.5,1158.4375" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="140.5" x2="579.5" y1="1158.4375" y2="1158.4375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="147.5" y="1136.0703">15</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="384" x="177.5" y="1120.9766">PUT /sendmoney/{transferId} (sync)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="227" x="184.5" y="1151.1641">("acceptQuote": true)</text><polygon fill="#383838" points="927.5,1198.625,937.5,1202.625,927.5,1206.625,931.5,1202.625" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="585.5" x2="933.5" y1="1202.625" y2="1202.625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="592.5" y="1195.3516">16</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="173" x="622.5" y="1195.3516">POST /transfers</text><line style="stroke:#383838;stroke-width:1.0;" x1="939.5" x2="981.5" y1="1246.8125" y2="1246.8125"/><line style="stroke:#383838;stroke-width:1.0;" x1="981.5" x2="981.5" y1="1246.8125" y2="1259.8125"/><line style="stroke:#383838;stroke-width:1.0;" x1="940.5" x2="981.5" y1="1259.8125" y2="1259.8125"/><polygon fill="#383838" points="950.5,1255.8125,940.5,1259.8125,950.5,1263.8125,946.5,1259.8125" style="stroke:#383838;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="946.5" y="1239.5391">17</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="244" x="976.5" y="1239.5391">Perform liquidity check</text><path d="M10,1274.8125 L83,1274.8125 L83,1296.8125 L73,1306.8125 L10,1306.8125 L10,1274.8125 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="312.5" style="stroke:#000000;stroke-width:2.0;" width="1171.5" x="10" y="1274.8125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="28" x="25" y="1300.7266">alt</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="453" x="98" y="1301.7266">[Transfer execution would exceed NDC]</text><polygon fill="#383838" points="596.5,1354.375,586.5,1358.375,596.5,1362.375,592.5,1358.375" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="590.5" x2="938.5" y1="1358.375" y2="1358.375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="602.5" y="1351.1016">18</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="254" x="632.5" y="1351.1016">PUT /transfers/{id}/error</text><polygon fill="#383838" points="151.5,1428.75,141.5,1432.75,151.5,1436.75,147.5,1432.75" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="145.5" x2="584.5" y1="1432.75" y2="1432.75"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="157.5" y="1410.3828">19</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="130" x="187.5" y="1395.2891">Return error</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="247" x="194.5" y="1425.4766">HTTP 200 result (sync)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1181.5" y1="1441.75" y2="1441.75"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="467" x="15" y="1466.6641">[Transfer execution will not exceed NDC]</text><line style="stroke:#383838;stroke-width:1.0;" x1="939.5" x2="981.5" y1="1509.125" y2="1509.125"/><line style="stroke:#383838;stroke-width:1.0;" x1="981.5" x2="981.5" y1="1509.125" y2="1522.125"/><line style="stroke:#383838;stroke-width:1.0;" x1="940.5" x2="981.5" y1="1522.125" y2="1522.125"/><polygon fill="#383838" points="950.5,1518.125,940.5,1522.125,950.5,1526.125,946.5,1522.125" style="stroke:#383838;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="946.5" y="1501.8516">20</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="155" x="976.5" y="1501.8516">Reserve funds</text><line style="stroke:#383838;stroke-width:1.0;" x1="939.5" x2="981.5" y1="1566.3125" y2="1566.3125"/><line style="stroke:#383838;stroke-width:1.0;" x1="981.5" x2="981.5" y1="1566.3125" y2="1579.3125"/><line style="stroke:#383838;stroke-width:1.0;" x1="940.5" x2="981.5" y1="1579.3125" y2="1579.3125"/><polygon fill="#383838" points="950.5,1575.3125,940.5,1579.3125,950.5,1583.3125,946.5,1579.3125" style="stroke:#383838;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="946.5" y="1559.0391">21</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="193" x="976.5" y="1559.0391">Perform validation</text><path d="M10,1601.3125 L83,1601.3125 L83,1623.3125 L73,1633.3125 L10,1633.3125 L10,1601.3125 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="491.4375" style="stroke:#000000;stroke-width:2.0;" width="1220.5" x="10" y="1601.3125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="28" x="25" y="1627.2266">alt</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="262" x="98" y="1628.2266">[Validation successful]</text><line style="stroke:#383838;stroke-width:1.0;" x1="939.5" x2="981.5" y1="1684.875" y2="1684.875"/><line style="stroke:#383838;stroke-width:1.0;" x1="981.5" x2="981.5" y1="1684.875" y2="1697.875"/><line style="stroke:#383838;stroke-width:1.0;" x1="940.5" x2="981.5" y1="1697.875" y2="1697.875"/><polygon fill="#383838" points="950.5,1693.875,940.5,1697.875,950.5,1701.875,946.5,1697.875" style="stroke:#383838;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="946.5" y="1677.6016">22</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="150" x="976.5" y="1677.6016">Commit funds</text><polygon fill="#383838" points="596.5,1768.25,586.5,1772.25,596.5,1776.25,592.5,1772.25" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="590.5" x2="938.5" y1="1772.25" y2="1772.25"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="602.5" y="1749.8828">23</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="197" x="632.5" y="1734.7891">PUT /transfers/{id}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="293" x="639.5" y="1764.9766">transferState=COMMITTED</text><polygon fill="#383838" points="151.5,1842.625,141.5,1846.625,151.5,1850.625,147.5,1846.625" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="145.5" x2="584.5" y1="1846.625" y2="1846.625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="157.5" y="1824.2578">24</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="210" x="187.5" y="1809.1641">Transfer successful</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="247" x="194.5" y="1839.3516">HTTP 200 result (sync)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1230.5" y1="1855.625" y2="1855.625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="187" x="15" y="1880.5391">[Validation fails]</text><line style="stroke:#383838;stroke-width:1.0;" x1="939.5" x2="981.5" y1="1923" y2="1923"/><line style="stroke:#383838;stroke-width:1.0;" x1="981.5" x2="981.5" y1="1923" y2="1936"/><line style="stroke:#383838;stroke-width:1.0;" x1="940.5" x2="981.5" y1="1936" y2="1936"/><polygon fill="#383838" points="950.5,1932,940.5,1936,950.5,1940,946.5,1936" style="stroke:#383838;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="946.5" y="1915.7266">25</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="242" x="976.5" y="1915.7266">Cancel reserved funds</text><polygon fill="#383838" points="596.5,2006.375,586.5,2010.375,596.5,2014.375,592.5,2010.375" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="590.5" x2="938.5" y1="2010.375" y2="2010.375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="602.5" y="1988.0078">26</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="197" x="632.5" y="1972.9141">PUT /transfers/{id}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="266" x="639.5" y="2003.1016">transferState=ABORTED</text><polygon fill="#383838" points="151.5,2080.75,141.5,2084.75,151.5,2088.75,147.5,2084.75" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="145.5" x2="584.5" y1="2084.75" y2="2084.75"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="157.5" y="2062.3828">27</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="154" x="187.5" y="2047.2891">Transfer failed</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="247" x="194.5" y="2077.4766">HTTP 200 result (sync)</text><!--MD5=[fe62085726c6129361e0f07dd1585bf6]
@startuml

autonumber
skinparam activityFontSize 4
skinparam activityDiamondFontSize 30
skinparam activityArrowFontSize 24
skinparam defaultFontSize 24
skinparam noteFontSize 24
skinparam monochrome true

participant "DFSP Core Backend" as backend

participant "Payment Manager" as sob

participant "Mojaloop Switch" as sw


== send money ==

    backend -> sob: POST /sendmoney (sync)
    alt Payee not found
    sob -> sw: GET /parties/{type}/{id}
    sw -> sob: PUT /parties/{type}/{id}/error
    sob -> backend: Return error \n HTTP 200 result (sync)    
    else Payee DFSP and Payee found
    sob -> sw: GET /parties/{type}/{id}
    sw -> sob: PUT /parties/{type}/{id}
    sob -> backend: Return party info \n HTTP 200 result (sync) 
    end   
    backend -> sob: PUT /sendmoney/{transferId} (sync) \n ("acceptParty": true) 
    sob -> sw: POST /quotes
    alt Quote request fails
    sw -> sob: PUT /quotes/{id}/error
    sob -> backend: Return error \n HTTP 200 result (sync)
    else Quote request is successful
    sw -> sob: PUT /quotes/{id}
    sob -> sob: check quote rules
    sob -> backend: Return quote \n HTTP 200 result (sync)
    end
    backend -> sob: PUT /sendmoney/{transferId} (sync) \n ("acceptQuote": true)
    sob -> sw: POST /transfers
    sw -> sw: Perform liquidity check
    alt Transfer execution would exceed NDC
    sw -> sob: PUT /transfers/{id}/error
    sob -> backend: Return error \n HTTP 200 result (sync)
    else Transfer execution will not exceed NDC
    sw -> sw: Reserve funds
    sw -> sw: Perform validation
    end
    alt Validation successful
    sw -> sw: Commit funds
    sw -> sob: PUT /transfers/{id} \n transferState=COMMITTED
    sob -> backend: Transfer successful \n HTTP 200 result (sync)
    else Validation fails
    sw -> sw: Cancel reserved funds
    sw -> sob: PUT /transfers/{id} \n transferState=ABORTED
    sob -> backend: Transfer failed \n HTTP 200 result (sync)
    end

@enduml

PlantUML version 1.2021.00(Sun Jan 10 11:25:05 CET 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: Cp1250
Language: en
Country: US
--></g></svg>