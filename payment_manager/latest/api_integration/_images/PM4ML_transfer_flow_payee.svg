<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2611px" preserveAspectRatio="none" style="width:1375px;height:2611px;" version="1.1" viewBox="0 0 1375 2611" width="1375px" zoomAndPan="magnify"><defs><filter height="300%" id="f12zj3clgl78rz" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f12zj3clgl78rz)" height="286.5" style="stroke:#000000;stroke-width:2.0;" width="1046" x="10" y="217.75"/><rect fill="#FFFFFF" height="150.75" style="stroke:none;stroke-width:1.0;" width="1046" x="10" y="353.5"/><rect fill="#FFFFFF" filter="url(#f12zj3clgl78rz)" height="286.5" style="stroke:#000000;stroke-width:2.0;" width="1046" x="10" y="606.625"/><rect fill="#FFFFFF" height="150.75" style="stroke:none;stroke-width:1.0;" width="1046" x="10" y="742.375"/><rect fill="#FFFFFF" filter="url(#f12zj3clgl78rz)" height="1340" style="stroke:#000000;stroke-width:2.0;" width="1348.5" x="10" y="1197.25"/><rect fill="#FFFFFF" height="558.4375" style="stroke:none;stroke-width:1.0;" width="1348.5" x="10" y="1390.1875"/><rect fill="#FFFFFF" height="588.625" style="stroke:none;stroke-width:1.0;" width="1348.5" x="10" y="1948.625"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="116" x2="116" y1="54.1875" y2="2554.25"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="478.5" x2="478.5" y1="54.1875" y2="2554.25"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="925" x2="925" y1="54.1875" y2="2554.25"/><rect fill="#F8F8F8" filter="url(#f12zj3clgl78rz)" height="44.1875" style="stroke:#383838;stroke-width:1.5;" width="189" x="20" y="5"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="175" x="27" y="36.9141">Mojaloop Switch</text><rect fill="#F8F8F8" filter="url(#f12zj3clgl78rz)" height="44.1875" style="stroke:#383838;stroke-width:1.5;" width="189" x="20" y="2553.25"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="175" x="27" y="2585.1641">Mojaloop Switch</text><rect fill="#F8F8F8" filter="url(#f12zj3clgl78rz)" height="44.1875" style="stroke:#383838;stroke-width:1.5;" width="210" x="371.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="196" x="378.5" y="36.9141">Payment Manager</text><rect fill="#F8F8F8" filter="url(#f12zj3clgl78rz)" height="44.1875" style="stroke:#383838;stroke-width:1.5;" width="210" x="371.5" y="2553.25"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="196" x="378.5" y="2585.1641">Payment Manager</text><rect fill="#F8F8F8" filter="url(#f12zj3clgl78rz)" height="44.1875" style="stroke:#383838;stroke-width:1.5;" width="237" x="805" y="5"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="223" x="812" y="36.9141">DFSP Core Backend</text><rect fill="#F8F8F8" filter="url(#f12zj3clgl78rz)" height="44.1875" style="stroke:#383838;stroke-width:1.5;" width="237" x="805" y="2553.25"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="223" x="812" y="2585.1641">DFSP Core Backend</text><rect fill="#EEEEEE" filter="url(#f12zj3clgl78rz)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1368.5" x="0" y="92.2813"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1368.5" y1="92.2813" y2="92.2813"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1368.5" y1="95.2813" y2="95.2813"/><rect fill="#EEEEEE" filter="url(#f12zj3clgl78rz)" height="38.1875" style="stroke:#000000;stroke-width:2.0;" width="186" x="591.25" y="74.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="165" x="597.25" y="103.1016">receive money</text><polygon fill="#383838" points="466.5,154.5625,476.5,158.5625,466.5,162.5625,470.5,158.5625" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="116.5" x2="472.5" y1="158.5625" y2="158.5625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="13" x="123.5" y="151.2891">1</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="246" x="140.5" y="151.2891">GET /parties/{type}/{id}</text><polygon fill="#383838" points="913.5,198.75,923.5,202.75,913.5,206.75,917.5,202.75" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="478.5" x2="919.5" y1="202.75" y2="202.75"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="13" x="485.5" y="195.4766">2</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="406" x="502.5" y="195.4766">GET /parties/{idType}/{idValue} (sync)</text><path d="M10,217.75 L83,217.75 L83,239.75 L73,249.75 L10,249.75 L10,217.75 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="286.5" style="stroke:#000000;stroke-width:2.0;" width="1046" x="10" y="217.75"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="28" x="25" y="243.6641">alt</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="204" x="98" y="244.6641">[Payee not found]</text><polygon fill="#383838" points="489.5,297.3125,479.5,301.3125,489.5,305.3125,485.5,301.3125" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="483.5" x2="924.5" y1="301.3125" y2="301.3125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="13" x="495.5" y="294.0391">3</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="203" x="512.5" y="294.0391">Return error (sync)</text><polygon fill="#383838" points="127.5,341.5,117.5,345.5,127.5,349.5,123.5,345.5" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="121.5" x2="477.5" y1="345.5" y2="345.5"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="13" x="133.5" y="338.2266">4</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="301" x="150.5" y="338.2266">PUT /parties/{type}/{id}/error</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1056" y1="354.5" y2="354.5"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="159" x="15" y="379.4141">[Payee found]</text><polygon fill="#383838" points="489.5,448.0625,479.5,452.0625,489.5,456.0625,485.5,452.0625" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="483.5" x2="924.5" y1="452.0625" y2="452.0625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="13" x="495.5" y="429.6953">5</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="193" x="512.5" y="414.6016">Return Payee info</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="247" x="519.5" y="444.7891">HTTP 200 result (sync)</text><polygon fill="#383838" points="127.5,492.25,117.5,496.25,127.5,500.25,123.5,496.25" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="121.5" x2="477.5" y1="496.25" y2="496.25"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="13" x="133.5" y="488.9766">6</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="244" x="150.5" y="488.9766">PUT /parties/{type}/{id}</text><polygon fill="#383838" points="466.5,543.4375,476.5,547.4375,466.5,551.4375,470.5,547.4375" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="116.5" x2="472.5" y1="547.4375" y2="547.4375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="13" x="123.5" y="540.1641">7</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="152" x="140.5" y="540.1641">POST /quotes</text><polygon fill="#383838" points="913.5,587.625,923.5,591.625,913.5,595.625,917.5,591.625" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="478.5" x2="919.5" y1="591.625" y2="591.625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="13" x="485.5" y="584.3516">8</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="306" x="502.5" y="584.3516">POST /quoterequests (sync)</text><path d="M10,606.625 L83,606.625 L83,628.625 L73,638.625 L10,638.625 L10,606.625 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="286.5" style="stroke:#000000;stroke-width:2.0;" width="1046" x="10" y="606.625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="28" x="25" y="632.5391">alt</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="233" x="98" y="633.5391">[Quote request fails]</text><polygon fill="#383838" points="489.5,686.1875,479.5,690.1875,489.5,694.1875,485.5,690.1875" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="483.5" x2="924.5" y1="690.1875" y2="690.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="13" x="495.5" y="682.9141">9</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="203" x="512.5" y="682.9141">Return error (sync)</text><polygon fill="#383838" points="127.5,730.375,117.5,734.375,127.5,738.375,123.5,734.375" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="121.5" x2="477.5" y1="734.375" y2="734.375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="133.5" y="727.1016">10</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="233" x="163.5" y="727.1016">PUT /quotes/{id}/error</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1056" y1="743.375" y2="743.375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="335" x="15" y="768.2891">[Quote request is successful]</text><polygon fill="#383838" points="489.5,836.9375,479.5,840.9375,489.5,844.9375,485.5,840.9375" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="483.5" x2="924.5" y1="840.9375" y2="840.9375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="495.5" y="818.5703">11</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="141" x="525.5" y="803.4766">Return quote</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="247" x="532.5" y="833.6641">HTTP 200 result (sync)</text><polygon fill="#383838" points="127.5,881.125,117.5,885.125,127.5,889.125,123.5,885.125" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="121.5" x2="477.5" y1="885.125" y2="885.125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="133.5" y="877.8516">12</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="176" x="163.5" y="877.8516">PUT /quotes/{id}</text><line style="stroke:#383838;stroke-width:1.0;" x1="116.5" x2="158.5" y1="936.3125" y2="936.3125"/><line style="stroke:#383838;stroke-width:1.0;" x1="158.5" x2="158.5" y1="936.3125" y2="949.3125"/><line style="stroke:#383838;stroke-width:1.0;" x1="117.5" x2="158.5" y1="949.3125" y2="949.3125"/><polygon fill="#383838" points="127.5,945.3125,117.5,949.3125,127.5,953.3125,123.5,949.3125" style="stroke:#383838;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="123.5" y="929.0391">13</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="318" x="153.5" y="929.0391">Perform (NDC) liquidity check</text><line style="stroke:#383838;stroke-width:1.0;" x1="116.5" x2="158.5" y1="993.5" y2="993.5"/><line style="stroke:#383838;stroke-width:1.0;" x1="158.5" x2="158.5" y1="993.5" y2="1006.5"/><line style="stroke:#383838;stroke-width:1.0;" x1="117.5" x2="158.5" y1="1006.5" y2="1006.5"/><polygon fill="#383838" points="127.5,1002.5,117.5,1006.5,127.5,1010.5,123.5,1006.5" style="stroke:#383838;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="123.5" y="986.2266">14</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="155" x="153.5" y="986.2266">Reserve funds</text><polygon fill="#383838" points="466.5,1046.6875,476.5,1050.6875,466.5,1054.6875,470.5,1050.6875" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="116.5" x2="472.5" y1="1050.6875" y2="1050.6875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="123.5" y="1043.4141">15</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="173" x="153.5" y="1043.4141">POST /transfers</text><polygon fill="#383838" points="913.5,1121.0625,923.5,1125.0625,913.5,1129.0625,917.5,1125.0625" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="478.5" x2="919.5" y1="1125.0625" y2="1125.0625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="485.5" y="1102.6953">16</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="175" x="515.5" y="1087.6016">Process transfer</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="246" x="522.5" y="1117.7891">POST /transfers (sync)</text><line style="stroke:#383838;stroke-width:1.0;" x1="925.5" x2="967.5" y1="1169.25" y2="1169.25"/><line style="stroke:#383838;stroke-width:1.0;" x1="967.5" x2="967.5" y1="1169.25" y2="1182.25"/><line style="stroke:#383838;stroke-width:1.0;" x1="926.5" x2="967.5" y1="1182.25" y2="1182.25"/><polygon fill="#383838" points="936.5,1178.25,926.5,1182.25,936.5,1186.25,932.5,1182.25" style="stroke:#383838;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="932.5" y="1161.9766">17</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="254" x="962.5" y="1161.9766">Perform internal checks</text><path d="M10,1197.25 L83,1197.25 L83,1219.25 L73,1229.25 L10,1229.25 L10,1197.25 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="1340" style="stroke:#000000;stroke-width:2.0;" width="1348.5" x="10" y="1197.25"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="28" x="25" y="1223.1641">alt</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="480" x="98" y="1224.1641">[Transfer fails Payee DFSP internal check]</text><line style="stroke:#383838;stroke-width:1.0;" x1="925.5" x2="967.5" y1="1280.8125" y2="1280.8125"/><line style="stroke:#383838;stroke-width:1.0;" x1="967.5" x2="967.5" y1="1280.8125" y2="1293.8125"/><line style="stroke:#383838;stroke-width:1.0;" x1="926.5" x2="967.5" y1="1293.8125" y2="1293.8125"/><polygon fill="#383838" points="936.5,1289.8125,926.5,1293.8125,936.5,1297.8125,932.5,1293.8125" style="stroke:#383838;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="932.5" y="1273.5391">18</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="242" x="962.5" y="1273.5391">Cancel reserved funds</text><polygon fill="#383838" points="489.5,1334,479.5,1338,489.5,1342,485.5,1338" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="483.5" x2="924.5" y1="1338" y2="1338"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="495.5" y="1330.7266">19</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="203" x="525.5" y="1330.7266">Return error (sync)</text><polygon fill="#383838" points="127.5,1378.1875,117.5,1382.1875,127.5,1386.1875,123.5,1382.1875" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="121.5" x2="477.5" y1="1382.1875" y2="1382.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="133.5" y="1374.9141">20</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="254" x="163.5" y="1374.9141">PUT /transfers/{id}/error</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1358.5" y1="1391.1875" y2="1391.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="406" x="15" y="1416.1016">[Transfer fails validation by Switch]</text><line style="stroke:#383838;stroke-width:1.0;" x1="925.5" x2="967.5" y1="1458.5625" y2="1458.5625"/><line style="stroke:#383838;stroke-width:1.0;" x1="967.5" x2="967.5" y1="1458.5625" y2="1471.5625"/><line style="stroke:#383838;stroke-width:1.0;" x1="926.5" x2="967.5" y1="1471.5625" y2="1471.5625"/><polygon fill="#383838" points="936.5,1467.5625,926.5,1471.5625,936.5,1475.5625,932.5,1471.5625" style="stroke:#383838;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="932.5" y="1451.2891">21</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="155" x="962.5" y="1451.2891">Reserve funds</text><polygon fill="#383838" points="489.5,1541.9375,479.5,1545.9375,489.5,1549.9375,485.5,1545.9375" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="483.5" x2="924.5" y1="1545.9375" y2="1545.9375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="495.5" y="1523.5703">22</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="210" x="525.5" y="1508.4766">Transfer successful</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="247" x="532.5" y="1538.6641">HTTP 200 result (sync)</text><polygon fill="#383838" points="127.5,1616.3125,117.5,1620.3125,127.5,1624.3125,123.5,1620.3125" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="121.5" x2="477.5" y1="1620.3125" y2="1620.3125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="133.5" y="1597.9453">23</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="197" x="163.5" y="1582.8516">PUT /transfers/{id}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="282" x="170.5" y="1613.0391">transferState=RESERVED</text><line style="stroke:#383838;stroke-width:1.0;" x1="116.5" x2="158.5" y1="1664.5" y2="1664.5"/><line style="stroke:#383838;stroke-width:1.0;" x1="158.5" x2="158.5" y1="1664.5" y2="1677.5"/><line style="stroke:#383838;stroke-width:1.0;" x1="117.5" x2="158.5" y1="1677.5" y2="1677.5"/><polygon fill="#383838" points="127.5,1673.5,117.5,1677.5,127.5,1681.5,123.5,1677.5" style="stroke:#383838;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="123.5" y="1657.2266">24</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="193" x="153.5" y="1657.2266">Perform validation</text><line style="stroke:#383838;stroke-width:1.0;" x1="116.5" x2="158.5" y1="1721.6875" y2="1721.6875"/><line style="stroke:#383838;stroke-width:1.0;" x1="158.5" x2="158.5" y1="1721.6875" y2="1734.6875"/><line style="stroke:#383838;stroke-width:1.0;" x1="117.5" x2="158.5" y1="1734.6875" y2="1734.6875"/><polygon fill="#383838" points="127.5,1730.6875,117.5,1734.6875,127.5,1738.6875,123.5,1734.6875" style="stroke:#383838;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="123.5" y="1714.4141">25</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="242" x="153.5" y="1714.4141">Cancel reserved funds</text><polygon fill="#383838" points="466.5,1805.0625,476.5,1809.0625,466.5,1813.0625,470.5,1809.0625" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="116.5" x2="472.5" y1="1809.0625" y2="1809.0625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="123.5" y="1786.6953">26</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="229" x="153.5" y="1771.6016">PATCH /transfers/{id}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="266" x="160.5" y="1801.7891">transferState=ABORTED</text><polygon fill="#383838" points="913.5,1879.4375,923.5,1883.4375,913.5,1887.4375,917.5,1883.4375" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="478.5" x2="919.5" y1="1883.4375" y2="1883.4375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="485.5" y="1861.0703">27</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="280" x="515.5" y="1845.9766">PUT /transfers/{transferId}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="266" x="522.5" y="1876.1641">transferState=ABORTED</text><line style="stroke:#383838;stroke-width:1.0;" x1="925.5" x2="967.5" y1="1927.625" y2="1927.625"/><line style="stroke:#383838;stroke-width:1.0;" x1="967.5" x2="967.5" y1="1927.625" y2="1940.625"/><line style="stroke:#383838;stroke-width:1.0;" x1="926.5" x2="967.5" y1="1940.625" y2="1940.625"/><polygon fill="#383838" points="936.5,1936.625,926.5,1940.625,936.5,1944.625,932.5,1940.625" style="stroke:#383838;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="932.5" y="1920.3516">28</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="242" x="962.5" y="1920.3516">Cancel reserved funds</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1358.5" y1="1949.625" y2="1949.625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="268" x="15" y="1974.5391">[Transfer is successful]</text><line style="stroke:#383838;stroke-width:1.0;" x1="925.5" x2="967.5" y1="2017" y2="2017"/><line style="stroke:#383838;stroke-width:1.0;" x1="967.5" x2="967.5" y1="2017" y2="2030"/><line style="stroke:#383838;stroke-width:1.0;" x1="926.5" x2="967.5" y1="2030" y2="2030"/><polygon fill="#383838" points="936.5,2026,926.5,2030,936.5,2034,932.5,2030" style="stroke:#383838;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="932.5" y="2009.7266">29</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="155" x="962.5" y="2009.7266">Reserve funds</text><polygon fill="#383838" points="489.5,2100.375,479.5,2104.375,489.5,2108.375,485.5,2104.375" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="483.5" x2="924.5" y1="2104.375" y2="2104.375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="495.5" y="2082.0078">30</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="210" x="525.5" y="2066.9141">Transfer successful</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="247" x="532.5" y="2097.1016">HTTP 200 result (sync)</text><polygon fill="#383838" points="127.5,2174.75,117.5,2178.75,127.5,2182.75,123.5,2178.75" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="121.5" x2="477.5" y1="2178.75" y2="2178.75"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="133.5" y="2156.3828">31</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="197" x="163.5" y="2141.2891">PUT /transfers/{id}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="282" x="170.5" y="2171.4766">transferState=RESERVED</text><line style="stroke:#383838;stroke-width:1.0;" x1="116.5" x2="158.5" y1="2222.9375" y2="2222.9375"/><line style="stroke:#383838;stroke-width:1.0;" x1="158.5" x2="158.5" y1="2222.9375" y2="2235.9375"/><line style="stroke:#383838;stroke-width:1.0;" x1="117.5" x2="158.5" y1="2235.9375" y2="2235.9375"/><polygon fill="#383838" points="127.5,2231.9375,117.5,2235.9375,127.5,2239.9375,123.5,2235.9375" style="stroke:#383838;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="123.5" y="2215.6641">32</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="193" x="153.5" y="2215.6641">Perform validation</text><line style="stroke:#383838;stroke-width:1.0;" x1="116.5" x2="158.5" y1="2280.125" y2="2280.125"/><line style="stroke:#383838;stroke-width:1.0;" x1="158.5" x2="158.5" y1="2280.125" y2="2293.125"/><line style="stroke:#383838;stroke-width:1.0;" x1="117.5" x2="158.5" y1="2293.125" y2="2293.125"/><polygon fill="#383838" points="127.5,2289.125,117.5,2293.125,127.5,2297.125,123.5,2293.125" style="stroke:#383838;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="123.5" y="2272.8516">33</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="150" x="153.5" y="2272.8516">Commit funds</text><polygon fill="#383838" points="466.5,2363.5,476.5,2367.5,466.5,2371.5,470.5,2367.5" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="116.5" x2="472.5" y1="2367.5" y2="2367.5"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="123.5" y="2345.1328">34</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="229" x="153.5" y="2330.0391">PATCH /transfers/{id}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="293" x="160.5" y="2360.2266">transferState=COMMITTED</text><polygon fill="#383838" points="913.5,2437.875,923.5,2441.875,913.5,2445.875,917.5,2441.875" style="stroke:#383838;stroke-width:1.0;"/><line style="stroke:#383838;stroke-width:1.0;" x1="478.5" x2="919.5" y1="2441.875" y2="2441.875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="485.5" y="2419.5078">35</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="280" x="515.5" y="2404.4141">PUT /transfers/{transferId}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="293" x="522.5" y="2434.6016">transferState=COMMITTED</text><line style="stroke:#383838;stroke-width:1.0;" x1="925.5" x2="967.5" y1="2516.25" y2="2516.25"/><line style="stroke:#383838;stroke-width:1.0;" x1="967.5" x2="967.5" y1="2516.25" y2="2529.25"/><line style="stroke:#383838;stroke-width:1.0;" x1="926.5" x2="967.5" y1="2529.25" y2="2529.25"/><polygon fill="#383838" points="936.5,2525.25,926.5,2529.25,936.5,2533.25,932.5,2529.25" style="stroke:#383838;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="26" x="932.5" y="2493.8828">36</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="334" x="962.5" y="2478.7891">Move funds to Payee's account</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="377" x="969.5" y="2508.9766">managed internally in Payee DFSP</text><!--MD5=[595e3d3501ac9dfc389a08236b6a8a9c]
@startuml
autonumber
skinparam activityFontSize 4
skinparam activityDiamondFontSize 30
skinparam activityArrowFontSize 24
skinparam defaultFontSize 24
skinparam noteFontSize 24
skinparam monochrome true

participant "Mojaloop Switch" as sw

participant "Payment Manager" as sib
  
participant "DFSP Core Backend" as backend


== receive money ==

    sw -> sib: GET /parties/{type}/{id}
    sib -> backend: GET /parties/{idType}/{idValue} (sync)
    alt Payee not found
    backend -> sib: Return error (sync)
    sib -> sw: PUT /parties/{type}/{id}/error
    else Payee found
    backend -> sib: Return Payee info \n HTTP 200 result (sync)
    sib -> sw: PUT /parties/{type}/{id}
    end
    sw -> sib: POST /quotes
    sib -> backend: POST /quoterequests (sync)
    alt Quote request fails
    backend -> sib: Return error (sync)
    sib -> sw: PUT /quotes/{id}/error
    else Quote request is successful
    backend -> sib: Return quote \n HTTP 200 result (sync)
    sib -> sw: PUT /quotes/{id}
    end
    sw -> sw: Perform (NDC) liquidity check
    sw -> sw: Reserve funds
    sw -> sib: POST /transfers
    sib -> backend: Process transfer \n POST /transfers (sync)
    backend -> backend: Perform internal checks
    alt Transfer fails Payee DFSP internal check
    backend -> backend: Cancel reserved funds
    backend -> sib: Return error (sync)
    sib -> sw: PUT /transfers/{id}/error
    else Transfer fails validation by Switch
    backend -> backend: Reserve funds
    backend -> sib: Transfer successful \n HTTP 200 result (sync)
    sib -> sw: PUT /transfers/{id} \n transferState=RESERVED
    sw -> sw: Perform validation
    sw -> sw: Cancel reserved funds
    sw -> sib: PATCH /transfers/{id} \n transferState=ABORTED
    sib -> backend: PUT /transfers/{transferId} \n transferState=ABORTED
    backend -> backend: Cancel reserved funds
    else Transfer is successful
    backend -> backend: Reserve funds
    backend -> sib: Transfer successful \n HTTP 200 result (sync)
    sib -> sw: PUT /transfers/{id} \n transferState=RESERVED
    sw -> sw: Perform validation
    sw -> sw: Commit funds
    sw -> sib: PATCH /transfers/{id} \n transferState=COMMITTED
    sib -> backend: PUT /transfers/{transferId} \n transferState=COMMITTED
    backend -> backend: Move funds to Payee's account \n managed internally in Payee DFSP
    end

@enduml

PlantUML version 1.2021.00(Sun Jan 10 11:25:05 CET 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: Cp1250
Language: en
Country: US
--></g></svg>